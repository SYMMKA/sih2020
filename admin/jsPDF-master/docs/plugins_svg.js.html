<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>plugins/svg.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="-_anonymous_-jsPDF-API.GState.html">GState</a></li><li><a href="-_anonymous_-jsPDF-API.Matrix.html">Matrix</a></li><li><a href="-_anonymous_-jsPDF-API.ShadingPattern.html">ShadingPattern</a></li><li><a href="-_anonymous_-jsPDF-API.TilingPattern.html">TilingPattern</a></li><li><a href="jsPDF.html">jsPDF</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addFont">addFont</a></li><li><a href="global.html#addGState">addGState</a></li><li><a href="global.html#addHTML">addHTML</a></li><li><a href="global.html#addImage">addImage</a></li><li><a href="global.html#addMetadata">addMetadata</a></li><li><a href="global.html#addPattern">addPattern</a></li><li><a href="global.html#addSvg">addSvg</a></li><li><a href="global.html#addSvgAsImage">addSvgAsImage</a></li><li><a href="global.html#advancedAPI">advancedAPI</a></li><li><a href="global.html#arrayBufferToBase64">arrayBufferToBase64</a></li><li><a href="global.html#arrayBufferToBinaryString">arrayBufferToBinaryString</a></li><li><a href="global.html#autoPrint">autoPrint</a></li><li><a href="global.html#beginFormObject">beginFormObject</a></li><li><a href="global.html#beginTilingPattern">beginTilingPattern</a></li><li><a href="global.html#binaryStringToUint8Array">binaryStringToUint8Array</a></li><li><a href="global.html#CapJoinStyles">CapJoinStyles</a></li><li><a href="global.html#circle">circle</a></li><li><a href="global.html#clip">clip</a></li><li><a href="global.html#clip_fixed">clip_fixed</a></li><li><a href="global.html#clipEvenOdd">clipEvenOdd</a></li><li><a href="global.html#close">close</a></li><li><a href="global.html#comment">comment</a></li><li><a href="global.html#compatApi">compatApi</a></li><li><a href="global.html#curveTo">curveTo</a></li><li><a href="global.html#discardPath">discardPath</a></li><li><a href="global.html#doFormObject">doFormObject</a></li><li><a href="global.html#ellipse">ellipse</a></li><li><a href="global.html#endFormObject">endFormObject</a></li><li><a href="global.html#endTilingPattern">endTilingPattern</a></li><li><a href="global.html#fill">fill</a></li><li><a href="global.html#fillEvenOdd">fillEvenOdd</a></li><li><a href="global.html#fillStroke">fillStroke</a></li><li><a href="global.html#fillStrokeEvenOdd">fillStrokeEvenOdd</a></li><li><a href="global.html#getArraySum">getArraySum</a></li><li><a href="global.html#getFontList">getFontList</a></li><li><a href="global.html#getFontSize">getFontSize</a></li><li><a href="global.html#getFormObject">getFormObject</a></li><li><a href="global.html#getImageFileTypeByImageData">getImageFileTypeByImageData</a></li><li><a href="global.html#isAdvancedAPI">isAdvancedAPI</a></li><li><a href="global.html#line">line</a></li><li><a href="global.html#lines">lines</a></li><li><a href="global.html#lineTo">lineTo</a></li><li><a href="global.html#lstext">lstext</a></li><li><a href="global.html#matrixMult">matrixMult</a></li><li><a href="global.html#moveTo">moveTo</a></li><li><a href="global.html#output">output</a></li><li><a href="global.html#path">path</a></li><li><a href="global.html#rect">rect</a></li><li><a href="global.html#restoreGraphicsState">restoreGraphicsState</a></li><li><a href="global.html#roundedRect">roundedRect</a></li><li><a href="global.html#save">save</a></li><li><a href="global.html#saveGraphicsState">saveGraphicsState</a></li><li><a href="global.html#setCharSpace">setCharSpace</a></li><li><a href="global.html#setCurrentTransformationMatrix">setCurrentTransformationMatrix</a></li><li><a href="global.html#setDisplayMode">setDisplayMode</a></li><li><a href="global.html#setDrawColor">setDrawColor</a></li><li><a href="global.html#setFillColor">setFillColor</a></li><li><a href="global.html#setFont">setFont</a></li><li><a href="global.html#setFontSize">setFontSize</a></li><li><a href="global.html#setFontStyle">setFontStyle</a></li><li><a href="global.html#setGState">setGState</a></li><li><a href="global.html#setLanguage">setLanguage</a></li><li><a href="global.html#setLineCap">setLineCap</a></li><li><a href="global.html#setLineDashPattern">setLineDashPattern</a></li><li><a href="global.html#setLineJoin">setLineJoin</a></li><li><a href="global.html#setLineWidth">setLineWidth</a></li><li><a href="global.html#setMiterLimit">setMiterLimit</a></li><li><a href="global.html#setPage">setPage</a></li><li><a href="global.html#setProperties">setProperties</a></li><li><a href="global.html#setR2L">setR2L</a></li><li><a href="global.html#setTextColor">setTextColor</a></li><li><a href="global.html#stroke">stroke</a></li><li><a href="global.html#text">text</a></li><li><a href="global.html#triangle">triangle</a></li><li><a href="global.html#unitMatrix">unitMatrix</a></li><li><a href="global.html#validateStringAsBase64">validateStringAsBase64</a></li><li><a href="global.html#viewerPreferences">viewerPreferences</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">plugins/svg.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/** @preserve
jsPDF SVG plugin
Copyright (c) 2012 Willow Systems Corporation, willow-systems.com
*/
/**
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * ====================================================================
 */

(function(jsPDFAPI) {
  "use strict";

  /**
   * Parses SVG XML and converts only some of the SVG elements into
   * PDF elements.
   *
   * Supports:
   * paths
   *
   * @name addSvg
   * @public
   * @function
   * @param {String} SVG-Data as Text
   * @param {Number} x Coordinate (in units declared at inception of PDF document) against left edge of the page
   * @param {Number} y Coordinate (in units declared at inception of PDF document) against upper edge of the page
   * @param {Number} width of SVG (in units declared at inception of PDF document)
   * @param {Number} height of SVG (in units declared at inception of PDF document)
   * @returns {Object} jsPDF-instance
   */
  jsPDFAPI.addSvg = function(svgtext, x, y, w, h) {
    // 'this' is _jsPDF object returned when jsPDF is inited (new jsPDF())

    var undef;

    if (x === undef || y === undef) {
      throw new Error("addSVG needs values for 'x' and 'y'");
    }

    function InjectCSS(cssbody, document) {
      var styletag = document.createElement("style");
      styletag.type = "text/css";
      if (styletag.styleSheet) {
        // ie
        styletag.styleSheet.cssText = cssbody;
      } else {
        // others
        styletag.appendChild(document.createTextNode(cssbody));
      }
      document.getElementsByTagName("head")[0].appendChild(styletag);
    }

    function createWorkerNode(document) {
      var frameID = "childframe", // Date.now().toString() + '_' + (Math.random() * 100).toString()
        frame = document.createElement("iframe");

      InjectCSS(".jsPDF_sillysvg_iframe {display:none;position:absolute;}", document);

      frame.name = frameID;
      frame.setAttribute("width", 0);
      frame.setAttribute("height", 0);
      frame.setAttribute("frameborder", "0");
      frame.setAttribute("scrolling", "no");
      frame.setAttribute("seamless", "seamless");
      frame.setAttribute("class", "jsPDF_sillysvg_iframe");

      document.body.appendChild(frame);

      return frame;
    }

    function attachSVGToWorkerNode(svgtext, frame) {
      var framedoc = (frame.contentWindow || frame.contentDocument).document;
      framedoc.write(svgtext);
      framedoc.close();
      return framedoc.getElementsByTagName("svg")[0];
    }

    function convertPathToPDFLinesArgs(path) {
      "use strict";
      // we will use 'lines' method call. it needs:
      // - starting coordinate pair
      // - array of arrays of vector shifts (2-len for line, 6 len for bezier)
      // - scale array [horizontal, vertical] ratios
      // - style (stroke, fill, both)

      var x = parseFloat(path[1]),
        y = parseFloat(path[2]),
        vectors = [],
        position = 3,
        len = path.length;

      while (position &lt; len) {
        if (path[position] === "c") {
          vectors.push([
            parseFloat(path[position + 1]),
            parseFloat(path[position + 2]),
            parseFloat(path[position + 3]),
            parseFloat(path[position + 4]),
            parseFloat(path[position + 5]),
            parseFloat(path[position + 6])
          ]);
          position += 7;
        } else if (path[position] === "l") {
          vectors.push([parseFloat(path[position + 1]), parseFloat(path[position + 2])]);
          position += 3;
        } else {
          position += 1;
        }
      }
      return [x, y, vectors];
    }

    var workernode = createWorkerNode(document),
      svgnode = attachSVGToWorkerNode(svgtext, workernode),
      scale = [1, 1],
      svgw = parseFloat(svgnode.getAttribute("width")),
      svgh = parseFloat(svgnode.getAttribute("height"));

    if (svgw &amp;&amp; svgh) {
      // setting both w and h makes image stretch to size.
      // this may distort the image, but fits your demanded size
      if (w &amp;&amp; h) {
        scale = [w / svgw, h / svgh];
      }
      // if only one is set, that value is set as max and SVG
      // is scaled proportionately.
      else if (w) {
        scale = [w / svgw, w / svgw];
      } else if (h) {
        scale = [h / svgh, h / svgh];
      }
    }

    var i,
      l,
      tmp,
      linesargs,
      items = svgnode.childNodes;
    for (i = 0, l = items.length; i &lt; l; i++) {
      tmp = items[i];
      if (tmp.tagName &amp;&amp; tmp.tagName.toUpperCase() === "PATH") {
        linesargs = convertPathToPDFLinesArgs(tmp.getAttribute("d").split(" "));
        // path start x coordinate
        linesargs[0] = linesargs[0] * scale[0] + x; // where x is upper left X of image
        // path start y coordinate
        linesargs[1] = linesargs[1] * scale[1] + y; // where y is upper left Y of image
        // the rest of lines are vectors. these will adjust with scale value auto.
        this.lines.call(
          this,
          linesargs[2], // lines
          linesargs[0], // starting x
          linesargs[1], // starting y
          scale
        );
      }
    }

    // clean up
    // workernode.parentNode.removeChild(workernode)

    return this;
  };

  //fallback
  jsPDFAPI.addSVG = jsPDFAPI.addSvg;

  /**
   * Parses SVG XML and saves it as image into the PDF.
   *
   * Depends on canvas-element and canvg
   *
   * @name addSvgAsImage
   * @public
   * @function
   * @param {String} SVG-Data as Text
   * @param {Number} x Coordinate (in units declared at inception of PDF document) against left edge of the page
   * @param {Number} y Coordinate (in units declared at inception of PDF document) against upper edge of the page
   * @param {Number} width of SVG-Image (in units declared at inception of PDF document)
   * @param {Number} height of SVG-Image (in units declared at inception of PDF document)
   * @param {String} alias of SVG-Image (if used multiple times)
   * @param {String} compression of the generated JPEG, can have the values 'NONE', 'FAST', 'MEDIUM' and 'SLOW'
   * @param {Number} rotation of the image in degrees (0-359)
   *
   * @returns jsPDF
   * @methodOf jsPDF#
   */
  jsPDFAPI.addSvgAsImage = function(svg, x, y, w, h, alias, compression, rotation) {
    if (isNaN(x) || isNaN(y)) {
      console.error("jsPDF.addSvgAsImage: Invalid coordinates", arguments);
      throw new Error("Invalid coordinates passed to jsPDF.addSvgAsImage");
    }

    if (isNaN(w) || isNaN(h)) {
      console.error("jsPDF.addSvgAsImage: Invalid measurements", arguments);
      throw new Error("Invalid measurements (width and/or height) passed to jsPDF.addSvgAsImage");
    }

    var canvas = document.createElement("canvas");
    canvas.width = w;
    canvas.height = h;
    var ctx = canvas.getContext("2d");
    ctx.fillStyle = "#fff"; /// set white fill style
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    //load a svg snippet in the canvas with id = 'drawingArea'
    canvg(canvas, svg, {
      ignoreMouse: true,
      ignoreAnimation: true,
      ignoreDimensions: true,
      ignoreClear: true
    });

    this.addImage(canvas.toDataURL("image/jpeg", 1.0), x, y, w, h, compression, rotation);
    return this;
  };
})(jsPDF.API);
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Fri Sep 28 2018 18:01:09 GMT+0200 (Mitteleuropäische Sommerzeit) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
